<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Mapas</title>
    <meta name="description" content="" />
    <!--[if lt IE 9]>
        <script type="text/javascript">
          // create elements HTML5 for IE
          document.createElement("article");
          document.createElement("section");
          document.createElement("footer");
          document.createElement("header");
          document.createElement("hgroup");
          document.createElement("nav");
        </script>
        <![endif]-->
    <link rel="stylesheet" href="css/colorbrewer.css" type="text/css">
    <link href="css/styles.css" rel="stylesheet" media="all" />
    </head>
  <body>
    <!-- test caca -->
    <div id="wrapper">
      <header>
        <h1>Conocé las variaciones intercensales - Censo 2001 / 2010</h1>
        <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      </header>
      <nav>
        <h2>Población total</h2>
        <div id="filtros">
          <div class="filtro">
            <h3>Población</h3>
          </div>
          <div class="filtro">
            <h3>Vivienda</h3>
          </div>
          <div class="filtro">
            <h3>Hogares</h3>
          </div>
          <span class="clear"></span>
        </div>
        <span class="clear"></span>
      </nav>
      <section class="clear">
        <article class="col_1" id="svg">

        </article>
        <article class="col_2">
          <ul id="u_relevamiento">
            <li id="densidad" class="active" data-left="10"><h3>Variación</h3></li>
            <li id="hogares" data-left="145"><h3>Censo 2001</h3></li>
            <li id="viviendas" data-left="285"><h3>Censo 2010</h3></li>
          </ul>
          <div id="variables">
            <ul class="densidad">
              <li><a href="#Poblacion_Total-intercensal" title="Población Total — Variación 2001-2010">Población Total<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_Densidad-intercensal" title="Densidad Poblacional — Variación 2001-2010">Densidad<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_Varones-intercensal">Varones<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_Mujeres-intercensal">Mujeres<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_Analfabetos-intercensal" title="Analfabetismo — Variación 2001-2010">Analfabetos<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_Alfabetos-intercensal" title="Alfabetismo — Variación 2001-2010">Alfabetos<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_0a14-intercensal" title="Población de 0 a 14 años — Variación 2001-2010">0 a 14 años<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_15a64-intercensal" title="Población de 15 a 64 años — Variación 2001-2010">15 a 64 años<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_65ymas-intercensal" title="Población de 65 años o más — Variación 2001-2010">65 años o más<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_Nacida_Extranjero-intercensal" title="Nacidos en el extranjero — Variación 2001-2010">Nacidos en el extranjero<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Poblacion_Nacida_Argentina-intercensal" title="Nacidos en Argentina — Variación 2001-2010">Nacidos en el extranjero<img src="img/arg_3.jpg" /></a></li>
            </ul>
            <ul class="hogares">
              <li><a href="#Hogares_Total">Hogares_Total<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Con_Bano">Hogares_Con_Bano<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Sin_Bano">Hogares_Sin_Bano<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Con_Gas_Corriente">Hogares_Con_Gas_Corriente<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Sin_Gas_Corriente">Hogares_Sin_Gas_Corriente<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Con_Agua_Corriente">Hogares_Con_Agua_Corriente<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Sin_Agua_Corriente">Hogares_Sin_Agua_Corriente<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Con_Heladera">Hogares_Con_Heladera<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Sin_Heladera">Hogares_Sin_Heladera<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Con_Telefono_Linea">Hogares_Con_Telefono_Linea<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Sin_Telefono_Linea">Hogares_Sin_Telefono_Linea<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Con_Celular">Hogares_Con_Celular<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Sin_Celular">Hogares_Sin_Celular<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Sin_Computadora">Hogares_Sin_Computadora<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Hogares_Con_Computadora">Hogares_Con_Computadora<img src="img/arg_3.jpg" /></a></li>
            </ul>
            <ul class="viviendas">
              <li><a href="#Viviendas_Total"><span>Viviendas_Total</span> <img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Viviendas_Casa">Viviendas_Casa<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Viviendas_Rancho">Viviendas_Rancho<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Viviendas_Casilla">Viviendas_Casilla<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Viviendas_Departamento">Viviendas_Departamento<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Viviendas_Pieza_Inquilinato">Viviendas_Pieza_Inquilinato<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Viviendas_Pieza_Hotel_Pension">Viviendas_Pieza_Hotel_Pension<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Viviendas_Local_No_Construido_Para_habitacion">Viviendas_Local_No_Construido_Para_habitacion<img src="img/arg_3.jpg" /></a></li>
              <li><a href="#Viviendas_movil">Viviendas_movil<img src="img/arg_3.jpg" /></a></li>
            </ul>
          </div>
          <span class="clear"></span>
          <table>
            <thead>
              <tr>
                <th colspan="3">Ranking de variación intersensal</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="td_1">1</td>
                <td class="td_2">Iguazú</td>
                <td class="td_3">Misiones</td>
              </tr>
            </tbody>
          </table>
        </article>
      </section>
      <footer>
        <p>

        </p>
      </footer>
      <!-- tooltip -->
      <div id="tooltip">
        <div class="header">
          <h3>Bahía Blanca</h3>
          <p>Prov de Buenos Aires</p>
        </div>
        <table>
          <thead>
            <tr>
              <th class="th1">Población total</th>
              <th class="th2">4.524.548</th>
              <th class="th3">+6%</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="th1">Densidad</td>
              <td class="th2">xxxx</td>
              <td class="th3">+4%</td>
            </tr>
            <tr>
              <td class="th1">Densidad</td>
              <td class="th2">xxxx</td>
              <td class="th3">+4%</td>
            </tr>
            <tr>
              <td class="th1">Densidad</td>
              <td class="th2">xxxx</td>
              <td class="th3">+4%</td>
            </tr>
          </tbody>
        </table>  
      </div>
    </div>
    <!--[if lte IE 8]><script src="js/r2d3.js" charset="utf-8"></script>
    <![endif]-->
    <!--[if gte IE 9]><!-->
        <script src="js/d3.v3.js"></script>
    <!--<![endif]-->
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/jquery.ba-hashchange.js"></script>
    <script src="js/topojson.v0.min.js"></script>
    <script src="js/handlebars.js"></script>
    <script src="js/scripts.js"></script>
    <script src="js/jenks.js"></script>
    <script src="js/censomapa.js"></script>

    <script id="distrito-info-template" type="text/x-handlebars-template">
      <h3>{{ lower DEPARTAMEN}}</h3>
      <h4>{{ lower PROVINCIA}}</h3>
      <p><strong>{{variable_name}}</strong>: {{variable_value}}
    </script>

    <script type="text/javascript">
    $(function() {
//        var map_data;

        /*var*/ getVariable = memoize(function(data, variable_name, year) {
            var col_idx = data['_column_names'].indexOf(variable_name);
            var year_idx = data['_years'].indexOf(year.toString());
            if (col_idx == -1 || year_idx == -1) return null;
            var rv = {};
            for (var dpto_id in data['_districts']) {
                var v = data['_districts'][dpto_id][year_idx][col_idx];
                if (v !== null) rv[dpto_id] = v;
            }
            return rv;
        });

        getVariableAsRatio = memoize(function(data, variable_name, year, variable_total) {
            var values = getVariable(data, variable_name, year);
            var totals = getVariable(data, variable_total, year);

            var rv = {};
            for (var dpto_id in values) {
                rv[dpto_id] = values[dpto_id] / totals[dpto_id];
            }
            return rv;
        });

        getIntercensalVariation = memoize(function(data, variable_name) {
            var values_2001 = getVariable(data, variable_name, 2001);
            var values_2010 = getVariable(data, variable_name, 2010);
            var rv = {};
            for (var dpto_id in values_2001) {
                rv[dpto_id] = (values_2010[dpto_id] - values_2001[dpto_id]) / values_2001[dpto_id];
            }

            return rv;
        });

        var drawMap = function(data, var_name, arg2, arg3) {
            var rv = null;
            if (arg2 == 'intercensal') {
                mapa.drawMap(getIntercensalVariation(map_data, var_name), 5);
                rv = true;
            }
            else if (arg2 == 'ratio') {
                var year = arg3;
                console.log(var_name, arg3, var_name.split('_')[0] + '_Total');
                mapa.drawMap(getVariableAsRatio(data, var_name, arg3, var_name.split('_')[0] + '_Total'), 5);
                rv = true;
            }
            else {
                mapa.drawMap(getVariable(data, var_name, arg2), 5);
                rv = true;
            }
            return rv;
        };

        $(window).hashchange( function(){
            // dibujar el mapa y setear el título
            if (location.hash.indexOf('#') !== 0) return;
            if (drawMap.apply(null, [map_data].concat(location.hash.substring(1).split('-'))) === null) return;
            $('nav h2').html($('a[href="'+location.hash+'"]').attr('title'));
        });

        // cargar geometrias
        $.get('data/ea.json', function(topojson) {
            mapa.drawPaths(topojson, 'article#svg');
            // cargar datos
            $.get('data/data.json',
                  function(data) {
                      map_data = data; // carga inicial de todos los datos
                      $(window).trigger('hashchange'); // disparo evento hashchange para carga inicial

                      $('g.mapa g.departamentos g').on('click', function() {
                          var id = $(this).attr('id').split(/provincia-(.+)/)[1];
                          mapa.zoomToProvincia(id == mapa.zoomedTo ? null : id);
                      });
                  });
        });
    });
    </script>
</body>
</html>
